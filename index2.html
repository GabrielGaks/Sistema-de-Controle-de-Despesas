<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Finance Master</title>
    
    <!-- Script anti-flash (deve ser o primeiro item no head) -->
    <script>
        (function() {
            // Esconder HTML para prevenir flash
            document.documentElement.style.visibility = 'hidden';
            // Verificar tema
            var isDark = localStorage.getItem('isDarkMode') === 'true';
            // Aplicar tema escuro imediatamente se necessário
            if (isDark) {
                document.documentElement.classList.add('dark-mode');
                document.documentElement.style.backgroundColor = '#1a1c23';
            }
            // Restaurar visibilidade quando o DOM estiver pronto
            document.addEventListener('DOMContentLoaded', function() {
                document.documentElement.style.visibility = '';
            });
        })();
    </script>
    
    <!-- Preload CSS para prevenir flash de tela branca -->
    <link rel="stylesheet" href="css/preload.css">
    <script src="js/preload.js"></script>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="css/transaction-styles.css">
    <link rel="stylesheet" href="css/enhanced-transaction-styles.css">
    <link rel="stylesheet" href="css/theme-styles.css">
    <link rel="stylesheet" href="css/animations.css">
    <link rel="stylesheet" href="css/calendar-dropdown.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;500;600;700&family=Quicksand:wght@400;500;600;700&display=swap">
</head>
<body class="bg-gray-100">
    <!-- Elemento de transição de página será inserido pelo preload.js -->

    <div class="w-[1200px] mx-auto bg-gray-50 shadow-xl rounded-xl font-sans overflow-hidden my-8 page-content">
        <header class="bg-gradient-to-r from-blue-600 to-blue-800 text-white p-6">
            <div class="flex justify-between items-center">
                <h1 class="text-3xl font-bold">Gestor</h1>
                <div class="flex space-x-4">
                    <a href="index2.html" class="bg-white bg-opacity-40 hover:bg-opacity-50 transition-all duration-300 rounded-lg px-4 py-2 flex items-center">
                        <span class="material-symbols-outlined mr-2">dashboard</span>
                        Dashboard
                    </a>
                    <a href="calendario-page.html" class="bg-white bg-opacity-20 hover:bg-opacity-30 transition-all duration-300 rounded-lg px-4 py-2 flex items-center">
                        <span class="material-symbols-outlined mr-2">calendar_month</span>
                        Calendário
                    </a>
                    <a href="settings-page.html" class="bg-white bg-opacity-20 hover:bg-opacity-30 transition-all duration-300 rounded-lg px-4 py-2 flex items-center">
                        <span class="material-symbols-outlined mr-2">settings</span>
                        Settings
                    </a>
                    <a href="profile-page.html" class="bg-white bg-opacity-20 hover:bg-opacity-30 transition-all duration-300 rounded-lg px-4 py-2 flex items-center">
                        <span class="material-symbols-outlined mr-2">person</span>
                        Profile
                    </a>
                </div>
            </div>
        </header>

        <div class="p-6">
            <div class="grid grid-cols-3 gap-6 mb-8">
                <div class="bg-white p-6 rounded-xl shadow-md hover:shadow-lg transition-shadow duration-300 transform hover:-translate-y-1 finance-card">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-xl font-semibold">Saldo Atual</h2>
                        <span class="material-symbols-outlined text-blue-600">account_balance_wallet</span>
                    </div>
                    <p class="text-4xl font-bold text-blue-600" id="current-balance">R$ 0,00</p>
                    <p class="text-sm text-gray-500 mt-2" id="last-update">Atualizado: Hoje às 10:45</p>
                </div>
                
                <div class="bg-white p-6 rounded-xl shadow-md hover:shadow-lg transition-shadow duration-300 transform hover:-translate-y-1 finance-card">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-xl font-semibold">Receitas</h2>
                        <span class="material-symbols-outlined text-green-600">trending_up</span>
                    </div>
                    <p class="text-4xl font-bold text-green-600" id="total-income">R$ 0,00</p>
                    <p class="text-sm text-gray-500 mt-2">Este mês</p>
                </div>
                
                <div class="bg-white p-6 rounded-xl shadow-md hover:shadow-lg transition-shadow duration-300 transform hover:-translate-y-1 finance-card">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-xl font-semibold">Despesas</h2>
                        <span class="material-symbols-outlined text-red-600">trending_down</span>
                    </div>
                    <p class="text-4xl font-bold text-red-600" id="total-expenses">R$ 0,00</p>
                    <p class="text-sm text-gray-500 mt-2">Este mês</p>
                </div>
            </div>

            <div class="grid grid-cols-2 gap-6">
                <div class="bg-white p-6 rounded-xl shadow-md">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-xl font-semibold">Transações Recentes</h2>
                        <div class="flex space-x-2">
                            <!-- Seletor de data estilizado -->
                            <div class="relative" id="dashboard-month-selector">
                                <button class="cursor-pointer bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 px-3 py-1 rounded-md flex items-center text-sm" id="dashboard-month-button">
                                    <span class="material-symbols-outlined mr-1 text-sm">calendar_today</span>
                                    <span id="dashboard-current-date">26 de abril de 2025</span>
                                    <span class="material-symbols-outlined ml-1 text-sm">expand_more</span>
                                </button>
                                <div class="hidden absolute right-0 mt-2 bg-white dark:bg-gray-800 rounded-md shadow-lg z-10 calendar-dropdown" id="dashboard-month-dropdown">
                                    <div class="p-4" style="width: 280px;">
                                        <!-- Cabeçalho do mês com navegação -->
                                        <div class="flex items-center justify-between mb-3">
                                            <button id="dash-prev-month" class="text-gray-600 hover:text-blue-600 dark:text-gray-300 dark:hover:text-blue-400">
                                                <span class="material-symbols-outlined">chevron_left</span>
                                            </button>
                                            <div class="text-sm font-medium" id="dash-current-month-display">abril de 2025</div>
                                            <button id="dash-next-month" class="text-gray-600 hover:text-blue-600 dark:text-gray-300 dark:hover:text-blue-400">
                                                <span class="material-symbols-outlined">chevron_right</span>
                                            </button>
                                        </div>

                                        <!-- Dias da semana -->
                                        <div class="grid grid-cols-7 gap-1 mb-2">
                                            <div class="text-center text-xs text-gray-500 dark:text-gray-400">D</div>
                                            <div class="text-center text-xs text-gray-500 dark:text-gray-400">S</div>
                                            <div class="text-center text-xs text-gray-500 dark:text-gray-400">T</div>
                                            <div class="text-center text-xs text-gray-500 dark:text-gray-400">Q</div>
                                            <div class="text-center text-xs text-gray-500 dark:text-gray-400">Q</div>
                                            <div class="text-center text-xs text-gray-500 dark:text-gray-400">S</div>
                                            <div class="text-center text-xs text-gray-500 dark:text-gray-400">S</div>
                                        </div>

                                        <!-- Dias do mês (serão preenchidos pelo JavaScript) -->
                                        <div class="grid grid-cols-7 gap-1 mb-3" id="dash-calendar-days">
                                            <!-- Dias serão inseridos dinamicamente -->
                                        </div>

                                        <!-- Seletor de mês -->
                                        <div class="pt-3 border-t">
                                            <div class="text-xs text-gray-500 dark:text-gray-400 mb-1">Mês:</div>
                                            <div class="grid grid-cols-4 gap-1 mb-2">
                                                <button class="text-center p-1 hover:bg-blue-50 dark:hover:bg-blue-900 rounded text-xs month-option" data-month="0">Jan</button>
                                                <button class="text-center p-1 hover:bg-blue-50 dark:hover:bg-blue-900 rounded text-xs month-option" data-month="1">Fev</button>
                                                <button class="text-center p-1 hover:bg-blue-50 dark:hover:bg-blue-900 rounded text-xs month-option" data-month="2">Mar</button>
                                                <button class="text-center p-1 bg-blue-100 dark:bg-blue-800 rounded text-xs font-medium month-option" data-month="3">Abr</button>
                                                <button class="text-center p-1 hover:bg-blue-50 dark:hover:bg-blue-900 rounded text-xs month-option" data-month="4">Mai</button>
                                                <button class="text-center p-1 hover:bg-blue-50 dark:hover:bg-blue-900 rounded text-xs month-option" data-month="5">Jun</button>
                                                <button class="text-center p-1 hover:bg-blue-50 dark:hover:bg-blue-900 rounded text-xs month-option" data-month="6">Jul</button>
                                                <button class="text-center p-1 hover:bg-blue-50 dark:hover:bg-blue-900 rounded text-xs month-option" data-month="7">Ago</button>
                                                <button class="text-center p-1 hover:bg-blue-50 dark:hover:bg-blue-900 rounded text-xs month-option" data-month="8">Set</button>
                                                <button class="text-center p-1 hover:bg-blue-50 dark:hover:bg-blue-900 rounded text-xs month-option" data-month="9">Out</button>
                                                <button class="text-center p-1 hover:bg-blue-50 dark:hover:bg-blue-900 rounded text-xs month-option" data-month="10">Nov</button>
                                                <button class="text-center p-1 hover:bg-blue-50 dark:hover:bg-blue-900 rounded text-xs month-option" data-month="11">Dez</button>
                                            </div>
                                        </div>

                                        <!-- Seletor de ano -->
                                        <div class="pt-2 border-t">
                                            <div class="text-xs text-gray-500 dark:text-gray-400 mb-1">Ano:</div>
                                            <div class="grid grid-cols-3 gap-1">
                                                <button class="w-full text-center p-1 hover:bg-blue-50 dark:hover:bg-blue-900 rounded text-xs font-medium year-option" data-year="2023">2023</button>
                                                <button class="w-full text-center p-1 hover:bg-blue-50 dark:hover:bg-blue-900 rounded text-xs font-medium year-option" data-year="2024">2024</button>
                                                <button class="w-full text-center p-1 bg-blue-100 dark:bg-blue-800 rounded text-xs font-medium year-option" data-year="2025">2025</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!-- Campo oculto para armazenar o valor selecionado -->
                                <input type="hidden" id="filter-date" value="2025-04-26">
                                <input type="hidden" id="filter-month" class="hidden" value="2025-04">
                            </div>
                            
                            <!-- Dropdown de tipo de transação estilizado -->
                            <div class="relative" id="transaction-type-selector">
                                <button class="cursor-pointer bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 px-3 py-1 rounded-md flex items-center text-sm" id="transaction-type-button">
                                    <span class="material-symbols-outlined mr-1 text-sm">filter_list</span>
                                    <span id="current-transaction-type">Todos</span>
                                    <span class="material-symbols-outlined ml-1 text-sm">expand_more</span>
                                </button>
                                <div class="hidden absolute right-0 mt-2 w-40 bg-white dark:bg-gray-800 rounded-md shadow-lg z-10 calendar-dropdown" id="transaction-type-dropdown">
                                    <div class="py-1">
                                        <button class="w-full text-left px-4 py-2 text-sm hover:bg-blue-50 dark:hover:bg-blue-900 bg-blue-100 dark:bg-blue-800" id="type-all">
                                            Todos
                                        </button>
                                        <button class="w-full text-left px-4 py-2 text-sm hover:bg-blue-50 dark:hover:bg-blue-900" id="type-income">
                                            <span class="inline-block w-3 h-3 rounded-full bg-green-500 mr-2"></span>Receitas
                                        </button>
                                        <button class="w-full text-left px-4 py-2 text-sm hover:bg-blue-50 dark:hover:bg-blue-900" id="type-expense">
                                            <span class="inline-block w-3 h-3 rounded-full bg-red-500 mr-2"></span>Despesas
                                        </button>
                                    </div>
                                </div>
                                <input type="hidden" id="filter-type" value="all">
                            </div>
                        </div>
                    </div>
                    
                    <div class="space-y-2" id="transactions-list">
                        <!-- Transactions will be added here dynamically -->
                    </div>
                </div>
                
                <div class="space-y-6">
                    <div class="bg-white p-6 rounded-xl shadow-md">
                        <h2 class="text-xl font-semibold mb-4">Adicionar Transação</h2>
                        
                        <form id="transaction-form" class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Tipo de Transação</label>
                                <div class="grid grid-cols-2 gap-2">
                                    <button type="button" onclick="setTransactionType('income')" class="bg-green-100 hover:bg-green-200 text-green-800 border border-green-300 rounded-lg py-2 flex items-center justify-center transition-colors transaction-type" data-type="income">
                                        <span class="material-symbols-outlined mr-2">add_circle</span>
                                        Receita
                                    </button>
                                    <button type="button" onclick="setTransactionType('expense')" class="bg-red-100 hover:bg-red-200 text-red-800 border border-red-300 rounded-lg py-2 flex items-center justify-center transition-colors transaction-type" data-type="expense">
                                        <span class="material-symbols-outlined mr-2">remove_circle</span>
                                        Despesa
                                    </button>
                                </div>
                                <input type="hidden" id="type" value="income" required>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Descrição</label>
                                <input type="text" id="description" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all" placeholder="Ex: Compras no supermercado" required />
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Valor (R$)</label>
                                <input type="number" id="amount" step="0.01" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all" placeholder="0,00" required />
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Categoria</label>
                                <select id="category" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all" required>
                                    <option value="salary">Salário</option>
                                    <option value="investment">Investimento</option>
                                    <option value="food">Alimentação</option>
                                    <option value="transport">Transporte</option>
                                    <option value="housing">Moradia</option>
                                    <option value="utilities">Contas</option>
                                    <option value="entertainment">Lazer</option>
                                    <option value="health">Saúde</option>
                                    <option value="education">Educação</option>
                                    <option value="other">Outros</option>
                                </select>
                            </div>
                            
                            <!-- Seletor de ícones -->
                            <div id="icon-selector-container"></div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Data</label>
                                <div class="relative" id="transaction-date-selector">
                                    <button class="w-full cursor-pointer bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 px-3 py-2 rounded-lg flex items-center text-sm border border-gray-300" id="transaction-date-button">
                                        <span class="material-symbols-outlined mr-1 text-sm">calendar_today</span>
                                        <span id="transaction-current-date">26 de abril de 2025</span>
                                        <span class="material-symbols-outlined ml-1 text-sm">expand_more</span>
                                    </button>
                                    <div class="hidden absolute left-0 mt-2 bg-white dark:bg-gray-800 rounded-md shadow-lg z-10 calendar-dropdown" id="transaction-date-dropdown">
                                        <div class="p-4" style="width: 280px;">
                                            <!-- Cabeçalho do mês com navegação -->
                                            <div class="flex items-center justify-between mb-3">
                                                <button id="transaction-prev-month" class="text-gray-600 hover:text-blue-600 dark:text-gray-300 dark:hover:text-blue-400">
                                                    <span class="material-symbols-outlined">chevron_left</span>
                                                </button>
                                                <div class="text-sm font-medium" id="transaction-current-month-display">abril de 2025</div>
                                                <button id="transaction-next-month" class="text-gray-600 hover:text-blue-600 dark:text-gray-300 dark:hover:text-blue-400">
                                                    <span class="material-symbols-outlined">chevron_right</span>
                                                </button>
                                            </div>

                                            <!-- Dias da semana -->
                                            <div class="grid grid-cols-7 gap-1 mb-2">
                                                <div class="text-center text-xs text-gray-500 dark:text-gray-400">D</div>
                                                <div class="text-center text-xs text-gray-500 dark:text-gray-400">S</div>
                                                <div class="text-center text-xs text-gray-500 dark:text-gray-400">T</div>
                                                <div class="text-center text-xs text-gray-500 dark:text-gray-400">Q</div>
                                                <div class="text-center text-xs text-gray-500 dark:text-gray-400">Q</div>
                                                <div class="text-center text-xs text-gray-500 dark:text-gray-400">S</div>
                                                <div class="text-center text-xs text-gray-500 dark:text-gray-400">S</div>
                                            </div>

                                            <!-- Dias do mês (serão preenchidos pelo JavaScript) -->
                                            <div class="grid grid-cols-7 gap-1 mb-3" id="transaction-calendar-days">
                                                <!-- Dias serão inseridos dinamicamente -->
                                            </div>

                                            <!-- Seletor de mês -->
                                            <div class="pt-3 border-t">
                                                <div class="text-xs text-gray-500 dark:text-gray-400 mb-1">Mês:</div>
                                                <div class="grid grid-cols-4 gap-1 mb-2">
                                                    <button class="text-center p-1 hover:bg-blue-50 dark:hover:bg-blue-900 rounded text-xs transaction-month-option" data-month="0">Jan</button>
                                                    <button class="text-center p-1 hover:bg-blue-50 dark:hover:bg-blue-900 rounded text-xs transaction-month-option" data-month="1">Fev</button>
                                                    <button class="text-center p-1 hover:bg-blue-50 dark:hover:bg-blue-900 rounded text-xs transaction-month-option" data-month="2">Mar</button>
                                                    <button class="text-center p-1 bg-blue-100 dark:bg-blue-800 rounded text-xs font-medium transaction-month-option" data-month="3">Abr</button>
                                                    <button class="text-center p-1 hover:bg-blue-50 dark:hover:bg-blue-900 rounded text-xs transaction-month-option" data-month="4">Mai</button>
                                                    <button class="text-center p-1 hover:bg-blue-50 dark:hover:bg-blue-900 rounded text-xs transaction-month-option" data-month="5">Jun</button>
                                                    <button class="text-center p-1 hover:bg-blue-50 dark:hover:bg-blue-900 rounded text-xs transaction-month-option" data-month="6">Jul</button>
                                                    <button class="text-center p-1 hover:bg-blue-50 dark:hover:bg-blue-900 rounded text-xs transaction-month-option" data-month="7">Ago</button>
                                                    <button class="text-center p-1 hover:bg-blue-50 dark:hover:bg-blue-900 rounded text-xs transaction-month-option" data-month="8">Set</button>
                                                    <button class="text-center p-1 hover:bg-blue-50 dark:hover:bg-blue-900 rounded text-xs transaction-month-option" data-month="9">Out</button>
                                                    <button class="text-center p-1 hover:bg-blue-50 dark:hover:bg-blue-900 rounded text-xs transaction-month-option" data-month="10">Nov</button>
                                                    <button class="text-center p-1 hover:bg-blue-50 dark:hover:bg-blue-900 rounded text-xs transaction-month-option" data-month="11">Dez</button>
                                                </div>
                                            </div>

                                            <!-- Seletor de ano -->
                                            <div class="pt-2 border-t">
                                                <div class="text-xs text-gray-500 dark:text-gray-400 mb-1">Ano:</div>
                                                <div class="grid grid-cols-3 gap-1">
                                                    <button class="w-full text-center p-1 hover:bg-blue-50 dark:hover:bg-blue-900 rounded text-xs font-medium transaction-year-option" data-year="2023">2023</button>
                                                    <button class="w-full text-center p-1 hover:bg-blue-50 dark:hover:bg-blue-900 rounded text-xs font-medium transaction-year-option" data-year="2024">2024</button>
                                                    <button class="w-full text-center p-1 bg-blue-100 dark:bg-blue-800 rounded text-xs font-medium transaction-year-option" data-year="2025">2025</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <input type="hidden" id="date" value="2025-04-26" required>
                                </div>
                            </div>
                            
                            <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white py-3 rounded-lg transition-colors font-medium transform hover:scale-[1.02] active:scale-[0.98]">
                                Adicionar Transação
                            </button>
                        </form>
                    </div>
                    
                    <div class="bg-white p-6 rounded-xl shadow-md">
                        <div class="flex justify-between items-center mb-4">
                            <h2 class="text-xl font-semibold">Gastos por Categoria</h2>
                            <select id="chart-period" class="px-3 py-1 border border-gray-300 rounded-md text-sm">
                                <option value="month">Este Mês</option>
                                <option value="3months">Últimos 3 Meses</option>
                                <option value="6months">Últimos 6 Meses</option>
                                <option value="year">Este Ano</option>
                            </select>
                        </div>
                        <div class="relative" style="height: 300px;">
                            <canvas id="expenses-chart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <footer class="bg-gray-100 p-6 mt-8">
            <div class="flex justify-between items-center">
                <p class="text-gray-600">&copy; 2023 Finance Master. Todos os direitos reservados.</p>
                <div class="flex space-x-4">
                    <button class="text-gray-600 hover:text-blue-600 transition-colors">
                        <span class="material-symbols-outlined">help</span>
                    </button>
                    <button class="text-gray-600 hover:text-blue-600 transition-colors">
                        <span class="material-symbols-outlined">support_agent</span>
                    </button>
                    <button class="text-gray-600 hover:text-blue-600 transition-colors">
                        <span class="material-symbols-outlined">info</span>
                    </button>
                </div>
            </div>
        </footer>
    </div>
    <script src="js/app.js"></script>
    <script>
        // Carregamento imediato da página sem delay
        document.addEventListener('DOMContentLoaded', function() {
            // Mostrar conteúdo da página imediatamente
            const pageContent = document.querySelector('.page-content');
            pageContent.style.opacity = '1';
            
            // Inicializar o novo seletor de data
            initDashboardDateSelector();
            
            // Inicializar o seletor de data para adicionar transação
            initTransactionDateSelector();
            
            // Inicializar o novo seletor de tipo de transação
            initTransactionTypeSelector();
        });
        
        // Função para inicializar o seletor de data personalizado
        function initDashboardDateSelector() {
            // Elementos do DOM
            const monthButton = document.getElementById('dashboard-month-button');
            const monthDropdown = document.getElementById('dashboard-month-dropdown');
            const calendarDays = document.getElementById('dash-calendar-days');
            const currentDateText = document.getElementById('dashboard-current-date');
            const currentMonthDisplay = document.getElementById('dash-current-month-display');
            const prevMonthBtn = document.getElementById('dash-prev-month');
            const nextMonthBtn = document.getElementById('dash-next-month');
            const monthOptions = document.querySelectorAll('#dashboard-month-dropdown .month-option');
            const yearOptions = document.querySelectorAll('#dashboard-month-dropdown .year-option');
            const hiddenDateInput = document.getElementById('filter-date');
            const hiddenMonthInput = document.getElementById('filter-month');
            
            // Variáveis de estado
            const today = new Date();
            let currentDate = new Date(); // Data atualmente exibida
            let selectedDate = new Date(); // Data selecionada pelo usuário
            
            // Nomes dos meses em português
            const monthNames = ['janeiro', 'fevereiro', 'março', 'abril', 'maio', 'junho', 
                               'julho', 'agosto', 'setembro', 'outubro', 'novembro', 'dezembro'];
            
            // Formatar data em português
            function formatDate(date) {
                return `${date.getDate()} de ${monthNames[date.getMonth()]} de ${date.getFullYear()}`;
            }
            
            // Formatar data no formato YYYY-MM-DD
            function formatDateISO(date) {
                const year = date.getFullYear();
                const month = String(date.getMonth() + 1).padStart(2, '0');
                const day = String(date.getDate()).padStart(2, '0');
                return `${year}-${month}-${day}`;
            }
            
            // Atualizar texto da data selecionada
            function updateCurrentDateText() {
                currentDateText.textContent = formatDate(selectedDate);
                currentMonthDisplay.textContent = `${monthNames[currentDate.getMonth()]} de ${currentDate.getFullYear()}`;
                
                // Atualizar inputs ocultos
                hiddenDateInput.value = formatDateISO(selectedDate);
                
                // Atualizar input de mês (formato YYYY-MM)
                const year = selectedDate.getFullYear();
                const month = String(selectedDate.getMonth() + 1).padStart(2, '0');
                hiddenMonthInput.value = `${year}-${month}`;
                
                // Disparar eventos change para notificar qualquer listener existente
                const dateEvent = new Event('change', { 'bubbles': true });
                const monthEvent = new Event('change', { 'bubbles': true });
                hiddenDateInput.dispatchEvent(dateEvent);
                hiddenMonthInput.dispatchEvent(monthEvent);
            }
            
            // Obter dias no mês atual
            function getDaysInMonth(date) {
                return new Date(date.getFullYear(), date.getMonth() + 1, 0).getDate();
            }
            
            // Obter primeiro dia da semana do mês (0 = domingo, 1 = segunda, etc)
            function getFirstDayOfMonth(date) {
                return new Date(date.getFullYear(), date.getMonth(), 1).getDay();
            }
            
            // Renderizar calendário
            function renderCalendar() {
                calendarDays.innerHTML = '';
                
                const daysInMonth = getDaysInMonth(currentDate);
                const firstDay = getFirstDayOfMonth(currentDate);
                const month = currentDate.getMonth();
                const year = currentDate.getFullYear();
                
                // Adicionar células vazias para os dias antes do primeiro dia do mês
                for (let i = 0; i < firstDay; i++) {
                    const emptyCell = document.createElement('div');
                    emptyCell.className = 'text-center p-1';
                    calendarDays.appendChild(emptyCell);
                }
                
                // Adicionar células para cada dia do mês
                for (let day = 1; day <= daysInMonth; day++) {
                    const date = new Date(year, month, day);
                    
                    // Verificar se é hoje
                    const isToday = day === today.getDate() && 
                                   month === today.getMonth() && 
                                   year === today.getFullYear();
                                   
                    // Verificar se é o dia selecionado
                    const isSelected = day === selectedDate.getDate() && 
                                      month === selectedDate.getMonth() && 
                                      year === selectedDate.getFullYear();
                    
                    const dayCell = document.createElement('button');
                    dayCell.className = `text-center p-1 text-xs rounded-full w-7 h-7 
                        ${isToday ? 'bg-blue-100 dark:bg-blue-900 font-bold text-blue-600 dark:text-blue-300' : ''}
                        ${isSelected ? 'ring-2 ring-blue-500 font-medium' : 'hover:bg-gray-100 dark:hover:bg-gray-700'}`;
                    dayCell.textContent = day;
                    
                    // Adicionar evento de clique
                    dayCell.addEventListener('click', () => {
                        // Atualizar a data selecionada
                        selectedDate = new Date(year, month, day);
                        
                        // Atualizar a UI
                        updateCurrentDateText();
                        
                        // Fechar dropdown
                        monthDropdown.classList.add('hidden');
                        
                        // Atualizar o calendário para destacar o dia selecionado
                        renderCalendar();
                    });
                    
                    calendarDays.appendChild(dayCell);
                }
                
                // Atualizar estado visual dos seletores de mês e ano
                monthOptions.forEach(option => {
                    const month = parseInt(option.dataset.month);
                    if (month === currentDate.getMonth()) {
                        option.classList.add('bg-blue-100', 'dark:bg-blue-800', 'font-medium');
                        option.classList.remove('hover:bg-blue-50', 'dark:hover:bg-blue-900');
                    } else {
                        option.classList.remove('bg-blue-100', 'dark:bg-blue-800', 'font-medium');
                        option.classList.add('hover:bg-blue-50', 'dark:hover:bg-blue-900');
                    }
                });
                
                yearOptions.forEach(option => {
                    const year = parseInt(option.dataset.year);
                    if (year === currentDate.getFullYear()) {
                        option.classList.add('bg-blue-100', 'dark:bg-blue-800', 'font-medium');
                        option.classList.remove('hover:bg-blue-50', 'dark:hover:bg-blue-900');
                    } else {
                        option.classList.remove('bg-blue-100', 'dark:bg-blue-800', 'font-medium');
                        option.classList.add('hover:bg-blue-50', 'dark:hover:bg-blue-900');
                    }
                });
            }
            
            // Inicializar com a data atual
            updateCurrentDateText();
            renderCalendar();
            
            // Configurar eventos de clique
            
            // Abrir/fechar dropdown ao clicar no botão principal
            monthButton.addEventListener('click', function() {
                monthDropdown.classList.toggle('hidden');
                if (!monthDropdown.classList.contains('hidden')) {
                    monthDropdown.classList.add('animating');
                }
            });
            
            // Fechar dropdown ao clicar fora
            document.addEventListener('click', function(event) {
                if (!monthButton.contains(event.target) && !monthDropdown.contains(event.target)) {
                    monthDropdown.classList.add('hidden');
                }
            });
            
            // Botões de navegação do mês
            prevMonthBtn.addEventListener('click', function(e) {
                e.stopPropagation();
                currentDate.setMonth(currentDate.getMonth() - 1);
                renderCalendar();
                updateCurrentDateText();
            });
            
            nextMonthBtn.addEventListener('click', function(e) {
                e.stopPropagation();
                currentDate.setMonth(currentDate.getMonth() + 1);
                renderCalendar();
                updateCurrentDateText();
            });
            
            // Configurar cliques nos meses
            monthOptions.forEach(option => {
                option.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const month = parseInt(this.dataset.month);
                    currentDate.setMonth(month);
                    renderCalendar();
                    updateCurrentDateText();
                });
            });
            
            // Configurar cliques nos anos
            yearOptions.forEach(option => {
                option.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const year = parseInt(this.dataset.year);
                    currentDate.setFullYear(year);
                    renderCalendar();
                    updateCurrentDateText();
                });
            });
        }
        
        // Função para inicializar o seletor de data para adicionar transação
        function initTransactionDateSelector() {
            // Elementos do DOM
            const dateButton = document.getElementById('transaction-date-button');
            const dateDropdown = document.getElementById('transaction-date-dropdown');
            const calendarDays = document.getElementById('transaction-calendar-days');
            const currentDateText = document.getElementById('transaction-current-date');
            const currentMonthDisplay = document.getElementById('transaction-current-month-display');
            const prevMonthBtn = document.getElementById('transaction-prev-month');
            const nextMonthBtn = document.getElementById('transaction-next-month');
            const monthOptions = document.querySelectorAll('#transaction-date-dropdown .transaction-month-option');
            const yearOptions = document.querySelectorAll('#transaction-date-dropdown .transaction-year-option');
            const hiddenDateInput = document.getElementById('date');
            
            // Variáveis de estado
            const today = new Date();
            let currentDate = new Date(); // Data atualmente exibida
            let selectedDate = new Date(); // Data selecionada pelo usuário
            
            // Nomes dos meses em português
            const monthNames = ['janeiro', 'fevereiro', 'março', 'abril', 'maio', 'junho', 
                               'julho', 'agosto', 'setembro', 'outubro', 'novembro', 'dezembro'];
            
            // Formatar data em português
            function formatDate(date) {
                return `${date.getDate()} de ${monthNames[date.getMonth()]} de ${date.getFullYear()}`;
            }
            
            // Formatar data no formato YYYY-MM-DD
            function formatDateISO(date) {
                const year = date.getFullYear();
                const month = String(date.getMonth() + 1).padStart(2, '0');
                const day = String(date.getDate()).padStart(2, '0');
                return `${year}-${month}-${day}`;
            }
            
            // Atualizar texto da data selecionada
            function updateCurrentDateText() {
                currentDateText.textContent = formatDate(selectedDate);
                currentMonthDisplay.textContent = `${monthNames[currentDate.getMonth()]} de ${currentDate.getFullYear()}`;
                
                // Atualizar input oculto
                hiddenDateInput.value = formatDateISO(selectedDate);
                
                // Disparar evento change para notificar qualquer listener existente
                const dateEvent = new Event('change', { 'bubbles': true });
                hiddenDateInput.dispatchEvent(dateEvent);
            }
            
            // Obter dias no mês atual
            function getDaysInMonth(date) {
                return new Date(date.getFullYear(), date.getMonth() + 1, 0).getDate();
            }
            
            // Obter primeiro dia da semana do mês (0 = domingo, 1 = segunda, etc)
            function getFirstDayOfMonth(date) {
                return new Date(date.getFullYear(), date.getMonth(), 1).getDay();
            }
            
            // Renderizar calendário
            function renderCalendar() {
                calendarDays.innerHTML = '';
                
                const daysInMonth = getDaysInMonth(currentDate);
                const firstDay = getFirstDayOfMonth(currentDate);
                const month = currentDate.getMonth();
                const year = currentDate.getFullYear();
                
                // Adicionar células vazias para os dias antes do primeiro dia do mês
                for (let i = 0; i < firstDay; i++) {
                    const emptyCell = document.createElement('div');
                    emptyCell.className = 'text-center p-1';
                    calendarDays.appendChild(emptyCell);
                }
                
                // Adicionar células para cada dia do mês
                for (let day = 1; day <= daysInMonth; day++) {
                    const date = new Date(year, month, day);
                    
                    // Verificar se é hoje
                    const isToday = day === today.getDate() && 
                                   month === today.getMonth() && 
                                   year === today.getFullYear();
                                   
                    // Verificar se é o dia selecionado
                    const isSelected = day === selectedDate.getDate() && 
                                      month === selectedDate.getMonth() && 
                                      year === selectedDate.getFullYear();
                    
                    const dayCell = document.createElement('button');
                    dayCell.className = `text-center p-1 text-xs rounded-full w-7 h-7 
                        ${isToday ? 'bg-blue-100 dark:bg-blue-900 font-bold text-blue-600 dark:text-blue-300' : ''}
                        ${isSelected ? 'ring-2 ring-blue-500 font-medium' : 'hover:bg-gray-100 dark:hover:bg-gray-700'}`;
                    dayCell.textContent = day;
                    
                    // Adicionar evento de clique
                    dayCell.addEventListener('click', () => {
                        // Atualizar a data selecionada
                        selectedDate = new Date(year, month, day);
                        
                        // Atualizar a UI
                        updateCurrentDateText();
                        
                        // Fechar dropdown
                        dateDropdown.classList.add('hidden');
                        
                        // Atualizar o calendário para destacar o dia selecionado
                        renderCalendar();
                    });
                    
                    calendarDays.appendChild(dayCell);
                }
                
                // Atualizar estado visual dos seletores de mês e ano
                monthOptions.forEach(option => {
                    const month = parseInt(option.dataset.month);
                    if (month === currentDate.getMonth()) {
                        option.classList.add('bg-blue-100', 'dark:bg-blue-800', 'font-medium');
                        option.classList.remove('hover:bg-blue-50', 'dark:hover:bg-blue-900');
                    } else {
                        option.classList.remove('bg-blue-100', 'dark:bg-blue-800', 'font-medium');
                        option.classList.add('hover:bg-blue-50', 'dark:hover:bg-blue-900');
                    }
                });
                
                yearOptions.forEach(option => {
                    const year = parseInt(option.dataset.year);
                    if (year === currentDate.getFullYear()) {
                        option.classList.add('bg-blue-100', 'dark:bg-blue-800', 'font-medium');
                        option.classList.remove('hover:bg-blue-50', 'dark:hover:bg-blue-900');
                    } else {
                        option.classList.remove('bg-blue-100', 'dark:bg-blue-800', 'font-medium');
                        option.classList.add('hover:bg-blue-50', 'dark:hover:bg-blue-900');
                    }
                });
            }
            
            // Inicializar com a data atual
            updateCurrentDateText();
            renderCalendar();
            
            // Configurar eventos de clique
            
            // Abrir/fechar dropdown ao clicar no botão principal
            dateButton.addEventListener('click', function(e) {
                e.preventDefault(); // Prevenir envio do formulário
                dateDropdown.classList.toggle('hidden');
                if (!dateDropdown.classList.contains('hidden')) {
                    dateDropdown.classList.add('animating');
                }
            });
            
            // Fechar dropdown ao clicar fora
            document.addEventListener('click', function(event) {
                if (!dateButton.contains(event.target) && !dateDropdown.contains(event.target)) {
                    dateDropdown.classList.add('hidden');
                }
            });
            
            // Botões de navegação do mês
            prevMonthBtn.addEventListener('click', function(e) {
                e.stopPropagation();
                currentDate.setMonth(currentDate.getMonth() - 1);
                renderCalendar();
                updateCurrentDateText();
            });
            
            nextMonthBtn.addEventListener('click', function(e) {
                e.stopPropagation();
                currentDate.setMonth(currentDate.getMonth() + 1);
                renderCalendar();
                updateCurrentDateText();
            });
            
            // Configurar cliques nos meses
            monthOptions.forEach(option => {
                option.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const month = parseInt(this.dataset.month);
                    currentDate.setMonth(month);
                    renderCalendar();
                    updateCurrentDateText();
                });
            });
            
            // Configurar cliques nos anos
            yearOptions.forEach(option => {
                option.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const year = parseInt(this.dataset.year);
                    currentDate.setFullYear(year);
                    renderCalendar();
                    updateCurrentDateText();
                });
            });
        }
        
        // Função para inicializar o seletor de tipo de transação
        function initTransactionTypeSelector() {
            const typeButton = document.getElementById('transaction-type-button');
            const typeDropdown = document.getElementById('transaction-type-dropdown');
            const currentTypeText = document.getElementById('current-transaction-type');
            const hiddenInput = document.getElementById('filter-type');
            const typeAll = document.getElementById('type-all');
            const typeIncome = document.getElementById('type-income');
            const typeExpense = document.getElementById('type-expense');
            
            // Abrir/fechar dropdown ao clicar no botão
            typeButton.addEventListener('click', function() {
                typeDropdown.classList.toggle('hidden');
            });
            
            // Fechar dropdown ao clicar fora
            document.addEventListener('click', function(event) {
                if (!typeButton.contains(event.target) && !typeDropdown.contains(event.target)) {
                    typeDropdown.classList.add('hidden');
                }
            });
            
            // Atualizar para "Todos"
            typeAll.addEventListener('click', function() {
                updateSelectedType('all', 'Todos');
                resetTypeButtons();
                this.classList.add('bg-blue-100', 'dark:bg-blue-800');
                this.classList.remove('hover:bg-blue-50', 'dark:hover:bg-blue-900');
            });
            
            // Atualizar para "Receitas"
            typeIncome.addEventListener('click', function() {
                updateSelectedType('income', 'Receitas');
                resetTypeButtons();
                this.classList.add('bg-blue-100', 'dark:bg-blue-800');
                this.classList.remove('hover:bg-blue-50', 'dark:hover:bg-blue-900');
            });
            
            // Atualizar para "Despesas"
            typeExpense.addEventListener('click', function() {
                updateSelectedType('expense', 'Despesas');
                resetTypeButtons();
                this.classList.add('bg-blue-100', 'dark:bg-blue-800');
                this.classList.remove('hover:bg-blue-50', 'dark:hover:bg-blue-900');
            });
            
            // Resetar aparência dos botões
            function resetTypeButtons() {
                [typeAll, typeIncome, typeExpense].forEach(btn => {
                    btn.classList.remove('bg-blue-100', 'dark:bg-blue-800');
                    btn.classList.add('hover:bg-blue-50', 'dark:hover:bg-blue-900');
                });
            }
            
            // Atualizar tipo selecionado
            function updateSelectedType(value, text) {
                currentTypeText.textContent = text;
                hiddenInput.value = value;
                typeDropdown.classList.add('hidden');
                
                // Disparar evento change para notificar listeners existentes
                const event = new Event('change', { 'bubbles': true });
                hiddenInput.dispatchEvent(event);
            }
        }
    </script>
</body>
</html>
